{"ast":null,"code":"import { createElement, Fragment, Component, PureComponent, createContext } from 'react';\nimport memoize from 'lodash/memoize';\nimport { renderAndAddProps } from 'render-and-add-props';\nimport produce$1, { produce } from 'immer';\nimport sortBy from 'lodash/sortBy';\nimport keys from 'lodash/keys';\nimport set from 'lodash/set';\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\n\n/* global Reflect, Promise */\n\nvar extendStatics = function (d, b) {\n  extendStatics = Object.setPrototypeOf || {\n    __proto__: []\n  } instanceof Array && function (d, b) {\n    d.__proto__ = b;\n  } || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n  };\n\n  return extendStatics(d, b);\n};\n\nfunction __extends(d, b) {\n  extendStatics(d, b);\n\n  function __() {\n    this.constructor = d;\n  }\n\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n\nvar __assign = function () {\n  __assign = Object.assign || function __assign(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nfunction __awaiter(thisArg, _arguments, P, generator) {\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : new P(function (resolve) {\n        resolve(result.value);\n      }).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\n\nfunction __generator(thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n}\n\nvar firebaseDatabaseDefaultContext = {\n  firebase: {}\n};\nvar getContext = memoize(function (createContext$$1) {\n  if (createContext$$1 === void 0) {\n    createContext$$1 = function (defaultContext) {\n      return createContext(defaultContext);\n    };\n  }\n\n  var _a = createContext$$1(firebaseDatabaseDefaultContext),\n      FirebaseDatabaseContextProvider = _a.Provider,\n      FirebaseDatabaseContextConsumer = _a.Consumer;\n\n  return {\n    FirebaseDatabaseContextProvider: FirebaseDatabaseContextProvider,\n    FirebaseDatabaseContextConsumer: FirebaseDatabaseContextConsumer\n  };\n}, function () {\n  return 1;\n});\n\nvar initializeFirebaseApp = function (_a) {\n  var firebase = _a.firebase,\n      authDomain = _a.authDomain,\n      databaseURL = _a.databaseURL,\n      projectId = _a.projectId,\n      storageBucket = _a.storageBucket,\n      messagingSenderId = _a.messagingSenderId,\n      apiKey = _a.apiKey,\n      appId = _a.appId,\n      measurementId = _a.measurementId;\n\n  try {\n    firebase.initializeApp({\n      apiKey: apiKey,\n      authDomain: authDomain,\n      databaseURL: databaseURL,\n      projectId: projectId,\n      storageBucket: storageBucket,\n      messagingSenderId: messagingSenderId,\n      appId: appId,\n      measurementId: measurementId\n    });\n  } catch (err) {\n    if (err.code !== \"app/duplicate-app\") {\n      throw err;\n    }\n  }\n};\n\nvar FirebaseDatabaseProvider = function (_super) {\n  __extends(FirebaseDatabaseProvider, _super);\n\n  function FirebaseDatabaseProvider(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this.__isMounted = true;\n    _this.state = {\n      firebase: props.firebase\n    };\n\n    if (_this.props.apiKey) {\n      initializeFirebaseApp(_this.props);\n    }\n\n    return _this;\n  }\n\n  FirebaseDatabaseProvider.prototype.render = function () {\n    var _a = this.props,\n        children = _a.children,\n        createContext$$1 = _a.createContext;\n    var FirebaseDatabaseContextProvider = getContext(createContext$$1).FirebaseDatabaseContextProvider;\n    return createElement(FirebaseDatabaseContextProvider, {\n      value: this.state\n    }, renderAndAddProps(children, {}));\n  };\n\n  return FirebaseDatabaseProvider;\n}(Component);\n\nvar getFirebaseQuery = function (_a) {\n  var _b = _a.firebase,\n      firebase = _b === void 0 ? null : _b,\n      path = _a.path,\n      _c = _a.orderByChild,\n      orderByChild = _c === void 0 ? null : _c,\n      _d = _a.orderByKey,\n      orderByKey = _d === void 0 ? null : _d,\n      _e = _a.orderByValue,\n      orderByValue = _e === void 0 ? null : _e,\n      _f = _a.limitToFirst,\n      limitToFirst = _f === void 0 ? null : _f,\n      _g = _a.limitToLast,\n      limitToLast = _g === void 0 ? null : _g,\n      _h = _a.startAt,\n      startAt = _h === void 0 ? null : _h,\n      _j = _a.endAt,\n      endAt = _j === void 0 ? null : _j,\n      _k = _a.equalTo,\n      equalTo = _k === void 0 ? null : _k;\n\n  if (firebase === null) {\n    throw new Error(\"Need to supply firebase argument to getFirebaseQuery\");\n  }\n\n  if (path === null || typeof path === \"undefined\") {\n    throw new Error(\"Need to supply path argument to getFirebaseQuery\");\n  }\n\n  var result = firebase.database().ref(path);\n\n  if (orderByChild !== null) {\n    result = result.orderByChild(orderByChild);\n  }\n\n  if (orderByKey !== null) {\n    result = result.orderByKey();\n  }\n\n  if (orderByValue !== null) {\n    result = result.orderByValue();\n  }\n\n  if (limitToFirst !== null) {\n    result = result.limitToFirst(limitToFirst);\n  }\n\n  if (limitToLast !== null) {\n    result = result.limitToLast(limitToLast);\n  }\n\n  if (startAt !== null) {\n    result = result.startAt(startAt);\n  }\n\n  if (endAt !== null) {\n    result = result.endAt(endAt);\n  }\n\n  if (equalTo !== null) {\n    result = result.equalTo(equalTo);\n  }\n\n  return result;\n};\n\nvar dataNodeProps = [\"firebase\", \"path\", \"orderByChild\", \"orderByKey\", \"orderByValue\", \"limitToFirst\", \"limitToLast\", \"startAt\", \"endAt\", \"equalTo\", \"keysOnly\", \"once\", \"isList\", \"unsub\"];\n\nvar getPropsOrNull = function (props) {\n  var cleanProps = {};\n\n  for (var _i = 0, dataNodeProps_1 = dataNodeProps; _i < dataNodeProps_1.length; _i++) {\n    var propName = dataNodeProps_1[_i];\n\n    if (props[propName]) {\n      cleanProps[propName] = props[propName];\n    } else {\n      cleanProps[propName] = null;\n    }\n  }\n\n  return cleanProps;\n};\n\nvar havePropsChanged = function (prevProps, props) {\n  for (var _i = 0, dataNodeProps_2 = dataNodeProps; _i < dataNodeProps_2.length; _i++) {\n    var propName = dataNodeProps_2[_i];\n\n    if (props[propName] !== prevProps[propName]) {\n      return true;\n    }\n  }\n\n  return false;\n};\n\nvar hasStateChanged = function (prevState, state) {\n  var keysICareAbout = [\"firebase\", \"value\", \"isLoading\", \"path\"];\n\n  for (var _i = 0, keysICareAbout_1 = keysICareAbout; _i < keysICareAbout_1.length; _i++) {\n    var propName = keysICareAbout_1[_i];\n\n    if (state[propName] !== prevState[propName]) {\n      return true;\n    }\n  }\n\n  return false;\n};\n\nvar reducers = {\n  setIsLoading: function (isLoading) {\n    return function (state) {\n      return produce(state, function (draft) {\n        draft.isLoading = isLoading;\n      });\n    };\n  },\n  setValue: function (value) {\n    return function (state) {\n      return produce(state, function (draft) {\n        draft.value = value;\n      });\n    };\n  },\n  setPath: function (path) {\n    return function (state) {\n      return produce(state, function (draft) {\n        draft.path = path;\n      });\n    };\n  },\n  addKeyToList: function (key) {\n    return function (state) {\n      return produce(state, function (draft) {\n        if (!Array.isArray(draft.value)) {\n          draft.value = [key];\n          return;\n        }\n\n        draft.value = draft.value.filter(function (k) {\n          return k !== key;\n        }).concat([key]);\n      });\n    };\n  },\n  removeKeyFromList: function (key) {\n    return function (state) {\n      return produce(state, function (draft) {\n        if (!Array.isArray(draft.value)) {\n          draft.value = [];\n          return;\n        }\n\n        draft.value = draft.value.filter(function (k) {\n          return k !== key;\n        });\n      });\n    };\n  },\n  addToList: function (value, key, order) {\n    return function (state) {\n      return produce(state, function (draft) {\n        if (!Array.isArray(draft.value)) {\n          draft.value = [{\n            data: value,\n            key: key,\n            order: order\n          }];\n          return;\n        }\n\n        var orderedList = draft.value.filter(function (v) {\n          return v.key !== key;\n        }).concat([{\n          data: value,\n          key: key,\n          order: order\n        }]);\n        draft.value = orderedList.sort(function (a, b) {\n          return a.order - b.order;\n        });\n      });\n    };\n  },\n  removeFromList: function (value, key) {\n    return function (state) {\n      return produce(state, function (draft) {\n        if (!Array.isArray(draft.value)) {\n          draft.value = [];\n          return;\n        }\n\n        draft.value = draft.value.filter(function (v) {\n          return v.key !== key;\n        });\n      });\n    };\n  },\n  removeFirstFromList: function (count) {\n    return function (state) {\n      return produce(state, function (draft) {\n        if (!Array.isArray(draft.value)) {\n          draft.value = [];\n          return;\n        }\n\n        var arrayLength = draft.value.length;\n        draft.value = draft.value.slice(arrayLength - count, arrayLength - 1);\n      });\n    };\n  },\n  removeLastFromList: function (count) {\n    return function (state) {\n      return produce(state, function (draft) {\n        if (!Array.isArray(draft.value)) {\n          draft.value = [];\n          return;\n        }\n\n        var arrayLength = draft.value.length;\n        draft.value = draft.value.slice(0, arrayLength - count);\n      });\n    };\n  },\n  prependKeyToList: function (key) {\n    return function (state) {\n      return produce(state, function (draft) {\n        if (!Array.isArray(draft.value)) {\n          draft.value = [key];\n          return;\n        }\n\n        draft.value = [key].concat(draft.value.filter(function (k) {\n          return k !== key;\n        }));\n      });\n    };\n  },\n  prependToList: function (value, key) {\n    return function (state) {\n      return produce(state, function (draft) {\n        if (!Array.isArray(draft.value)) {\n          draft.value = [{\n            data: value,\n            key: key\n          }];\n          return;\n        }\n\n        draft.value = [{\n          data: value,\n          key: key\n        }].concat(draft.value.filter(function (v) {\n          return v.key !== key;\n        }));\n      });\n    };\n  }\n};\n\nvar FirebaseDatabaseContextConsumerLifeCycle = function (_super) {\n  __extends(FirebaseDatabaseContextConsumerLifeCycle, _super);\n\n  function FirebaseDatabaseContextConsumerLifeCycle() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.state = {\n      firebase: null,\n      path: null,\n      orderByChild: null,\n      orderByKey: null,\n      orderByValue: null,\n      limitToFirst: null,\n      limitToLast: null,\n      startAt: null,\n      endAt: null,\n      equalTo: null,\n      keysOnly: null,\n      once: null,\n      isList: null,\n      unsub: null,\n      value: null,\n      isLoading: null\n    };\n    _this.__isMounted = false;\n\n    _this.ss = function () {\n      if (_this.__isMounted === false) {\n        return function () {};\n      }\n\n      return _this.setState.bind(_this);\n    };\n\n    _this.onValue = function (props, v) {\n      if (!v) return;\n      if (v.val() === null) return;\n      var value = v.val();\n      var keysOnly = props.keysOnly,\n          isList = props.isList,\n          orderByChild = props.orderByChild,\n          orderByKey = props.orderByKey,\n          orderByValue = props.orderByValue;\n\n      if (!keysOnly && !isList) {\n        _this.ss()(reducers.setValue(value));\n\n        return;\n      }\n\n      var unsortedKeys = keys(value);\n      var sortedKeys = orderByChild ? sortBy(unsortedKeys, function (key) {\n        return value[key][orderByChild];\n      }) : orderByKey ? sortBy(unsortedKeys, function (key) {\n        return key;\n      }) : orderByValue ? sortBy(unsortedKeys, function (key) {\n        return value[key];\n      }) : unsortedKeys;\n\n      if (keysOnly) {\n        _this.ss()(reducers.setValue(sortedKeys));\n\n        return;\n      }\n\n      if (isList) {\n        var val = sortedKeys.map(function (key) {\n          return {\n            key: key,\n            data: value[key]\n          };\n        });\n\n        _this.ss()(reducers.setValue(val));\n\n        return;\n      } else {\n        _this.ss()(reducers.setValue(value));\n\n        return;\n      }\n    };\n\n    _this.handleOnce = function (props, ref) {\n      _this.ss()(reducers.setIsLoading(true));\n\n      ref.once(\"value\", function (v) {\n        _this.ss()(reducers.setIsLoading(false));\n\n        _this.onValue(props, v);\n      });\n    };\n\n    _this.handleOn = function (props, ref) {\n      _this.unsub && _this.unsub();\n\n      _this.ss()(reducers.setIsLoading(true));\n\n      _this.unsub = ref.on(\"value\", function (v) {\n        _this.ss()(reducers.setIsLoading(false));\n\n        _this.onValue(props, v);\n      });\n    };\n\n    _this.listenToRef = function (props) {\n      var propsOrNull = getPropsOrNull(_this.props);\n      var firebase = propsOrNull.firebase,\n          path = propsOrNull.path;\n\n      if (firebase === null) {\n        return;\n      }\n\n      if (path === null) {\n        return;\n      }\n\n      _this.ss()(reducers.setPath(path));\n\n      _this.ss()(reducers.setIsLoading(true));\n\n      var query = getFirebaseQuery(propsOrNull);\n\n      if (propsOrNull.once) {\n        _this.handleOnce(props, query);\n      } else {\n        _this.handleOn(props, query);\n      }\n    };\n\n    return _this;\n  }\n\n  FirebaseDatabaseContextConsumerLifeCycle.prototype.componentDidMount = function () {\n    this.__isMounted = true;\n    this.listenToRef(getPropsOrNull(this.props));\n  };\n\n  FirebaseDatabaseContextConsumerLifeCycle.prototype.componentDidUpdate = function (prevProps) {\n    if (havePropsChanged(this.props, prevProps)) {\n      this.listenToRef(getPropsOrNull(this.props));\n    }\n  };\n\n  FirebaseDatabaseContextConsumerLifeCycle.prototype.componentWillUnmount = function () {\n    this.__isMounted = false;\n    this.unsub && this.unsub();\n  };\n\n  FirebaseDatabaseContextConsumerLifeCycle.prototype.shouldComponentUpdate = function (nextProps, nextState) {\n    return havePropsChanged(this.props, nextProps) || hasStateChanged(this.state, nextState);\n  };\n\n  FirebaseDatabaseContextConsumerLifeCycle.prototype.render = function () {\n    var _a = this.state,\n        path = _a.path,\n        value = _a.value,\n        isLoading = _a.isLoading;\n    return renderAndAddProps(this.props.children, {\n      path: path,\n      value: value,\n      isLoading: isLoading\n    });\n  };\n\n  return FirebaseDatabaseContextConsumerLifeCycle;\n}(Component);\n\nvar FirebaseDatabaseNode = function (_super) {\n  __extends(FirebaseDatabaseNode, _super);\n\n  function FirebaseDatabaseNode() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  FirebaseDatabaseNode.prototype.render = function () {\n    var _this = this;\n\n    var FirebaseDatabaseContextConsumer = getContext().FirebaseDatabaseContextConsumer;\n    return createElement(FirebaseDatabaseContextConsumer, null, function (context) {\n      return createElement(Fragment, null, createElement(FirebaseDatabaseContextConsumerLifeCycle, __assign({\n        firebase: context.firebase\n      }, _this.props)));\n    });\n  };\n\n  return FirebaseDatabaseNode;\n}(Component);\n\nvar initialState = {\n  isLoading: true,\n  value: {}\n};\n\nvar addNodeToState = function (state, _a) {\n  var id = _a.id,\n      value = _a.value,\n      isLoading = _a.isLoading;\n  var updatedState = produce$1(state, function (newState) {\n    set(newState, \"value.\" + id + \".value\", value);\n    set(newState, \"value.\" + id + \".isLoading\", isLoading);\n    return newState;\n  });\n  return updatedState;\n};\n\nvar PureNodeReader = function (_super) {\n  __extends(PureNodeReader, _super);\n\n  function PureNodeReader() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  PureNodeReader.prototype.componentDidMount = function () {\n    var _a = this.props,\n        id = _a.id,\n        value = _a.value,\n        isLoading = _a.isLoading,\n        onChange = _a.onChange;\n    onChange({\n      id: id,\n      value: value,\n      isLoading: isLoading,\n      onChange: onChange\n    });\n  };\n\n  PureNodeReader.prototype.componentDidUpdate = function () {\n    var _a = this.props,\n        id = _a.id,\n        value = _a.value,\n        isLoading = _a.isLoading,\n        onChange = _a.onChange;\n    onChange({\n      id: id,\n      value: value,\n      isLoading: isLoading,\n      onChange: onChange\n    });\n  };\n\n  PureNodeReader.prototype.shouldComponentUpdate = function (prevProps) {\n    var _a = this.props,\n        id = _a.id,\n        value = _a.value,\n        isLoading = _a.isLoading,\n        onChange = _a.onChange;\n    return prevProps.id !== id || prevProps.value !== value || prevProps.isLoading !== isLoading;\n  };\n\n  PureNodeReader.prototype.render = function () {\n    return null;\n  };\n\n  return PureNodeReader;\n}(Component);\n\nvar FirebaseDatabaseNodes = function (_super) {\n  __extends(FirebaseDatabaseNodes, _super);\n\n  function FirebaseDatabaseNodes() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.state = initialState;\n    return _this;\n  }\n\n  FirebaseDatabaseNodes.prototype.componentDidMount = function () {\n    var _loop_1 = function (node) {\n      var id = node.id;\n      this_1.setState(function (state) {\n        return addNodeToState(state, {\n          id: id,\n          value: null,\n          isLoading: true\n        });\n      });\n    };\n\n    var this_1 = this;\n\n    for (var _i = 0, _a = this.props.nodes; _i < _a.length; _i++) {\n      var node = _a[_i];\n\n      _loop_1(node);\n    }\n  };\n\n  FirebaseDatabaseNodes.prototype.componentDidUpdate = function () {\n    var nodeIDs = this.props.nodes.map(function (n) {\n      return n.id;\n    });\n\n    var _loop_2 = function (nodeID) {\n      if (!(nodeID in this_2.state.value)) {\n        this_2.setState(function (state) {\n          return addNodeToState(state, {\n            id: nodeID,\n            value: null,\n            isLoading: true\n          });\n        });\n      }\n    };\n\n    var this_2 = this;\n\n    for (var _i = 0, nodeIDs_1 = nodeIDs; _i < nodeIDs_1.length; _i++) {\n      var nodeID = nodeIDs_1[_i];\n\n      _loop_2(nodeID);\n    }\n  };\n\n  FirebaseDatabaseNodes.prototype.render = function () {\n    var _this = this;\n\n    return createElement(Fragment, null, this.props.nodes.map(function (node) {\n      return createElement(FirebaseDatabaseNode, __assign({\n        path: node.path,\n        key: node.id\n      }, node.query), function (_a) {\n        var value = _a.value,\n            isLoading = _a.isLoading;\n        return createElement(PureNodeReader, {\n          value: value,\n          isLoading: isLoading,\n          id: node.id,\n          onChange: function (_a) {\n            var id = _a.id,\n                value = _a.value,\n                isLoading = _a.isLoading;\n\n            _this.setState(function (state) {\n              return addNodeToState(state, {\n                id: id,\n                value: value,\n                isLoading: isLoading\n              });\n            });\n          }\n        });\n      });\n    }), renderAndAddProps(this.props.children, this.state));\n  };\n\n  return FirebaseDatabaseNodes;\n}(PureComponent);\n\nvar FirebaseDatabaseMutationWithContext = function (_super) {\n  __extends(FirebaseDatabaseMutationWithContext, _super);\n\n  function FirebaseDatabaseMutationWithContext() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.createMutationRunner = function () {\n      var _a = _this.props,\n          firebase = _a.firebase,\n          path = _a.path,\n          type = _a.type;\n      var firebaseRef = firebase.app().database().ref(path);\n      var runMutation;\n\n      switch (type) {\n        case \"push\":\n          {\n            runMutation = function (value) {\n              return __awaiter(_this, void 0, void 0, function () {\n                var key;\n                return __generator(this, function (_a) {\n                  switch (_a.label) {\n                    case 0:\n                      return [4, firebaseRef.push(value).key];\n\n                    case 1:\n                      key = _a.sent();\n                      return [2, {\n                        path: path,\n                        value: value,\n                        type: type,\n                        key: key\n                      }];\n                  }\n                });\n              });\n            };\n\n            break;\n          }\n\n        case \"update\":\n          {\n            runMutation = function (value) {\n              return __awaiter(_this, void 0, void 0, function () {\n                return __generator(this, function (_a) {\n                  switch (_a.label) {\n                    case 0:\n                      return [4, firebaseRef.update(value)];\n\n                    case 1:\n                      _a.sent();\n\n                      return [2, {\n                        path: path,\n                        value: value,\n                        type: type,\n                        key: null\n                      }];\n                  }\n                });\n              });\n            };\n\n            break;\n          }\n\n        case \"set\":\n          {\n            runMutation = function (value) {\n              return __awaiter(_this, void 0, void 0, function () {\n                return __generator(this, function (_a) {\n                  switch (_a.label) {\n                    case 0:\n                      return [4, firebaseRef.set(value)];\n\n                    case 1:\n                      _a.sent();\n\n                      return [2, {\n                        path: path,\n                        value: value,\n                        type: type,\n                        key: null\n                      }];\n                  }\n                });\n              });\n            };\n\n            break;\n          }\n\n        default:\n          {\n            throw new Error(\"Unsupported mutation type \" + type + \". \\nPlease file an issue if you'd like to see us support it !\");\n          }\n      }\n\n      return runMutation;\n    };\n\n    return _this;\n  }\n\n  FirebaseDatabaseMutationWithContext.prototype.shouldComponentUpdate = function (nextProps) {\n    return nextProps.path !== this.props.path || nextProps.firebase !== this.props.firebase;\n  };\n\n  FirebaseDatabaseMutationWithContext.prototype.render = function () {\n    var children = this.props.children;\n    var runMutation = this.createMutationRunner();\n    return renderAndAddProps(children, __assign({\n      runMutation: runMutation\n    }, this.props));\n  };\n\n  return FirebaseDatabaseMutationWithContext;\n}(Component);\n\nvar FirebaseDatabaseMutation = function (_super) {\n  __extends(FirebaseDatabaseMutation, _super);\n\n  function FirebaseDatabaseMutation() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  FirebaseDatabaseMutation.prototype.render = function () {\n    var _a = this.props,\n        children = _a.children,\n        type = _a.type,\n        path = _a.path;\n    var FirebaseDatabaseContextConsumer = getContext().FirebaseDatabaseContextConsumer;\n    return createElement(FirebaseDatabaseContextConsumer, null, function (context) {\n      return createElement(FirebaseDatabaseMutationWithContext, __assign({\n        type: type,\n        path: path\n      }, context, {\n        children: children\n      }));\n    });\n  };\n\n  return FirebaseDatabaseMutation;\n}(Component);\n\nvar FirebaseDatabaseTransactionWithContext = function (_super) {\n  __extends(FirebaseDatabaseTransactionWithContext, _super);\n\n  function FirebaseDatabaseTransactionWithContext() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.createTransactionRunner = function () {\n      var _a = _this.props,\n          firebase = _a.firebase,\n          path = _a.path;\n      var firebaseRef = firebase.app().database().ref(path);\n\n      var runTransaction = function (_a) {\n        var reducer = _a.reducer;\n        return __awaiter(_this, void 0, void 0, function () {\n          return __generator(this, function (_b) {\n            switch (_b.label) {\n              case 0:\n                return [4, firebaseRef.transaction(reducer)];\n\n              case 1:\n                _b.sent();\n\n                return [2, {\n                  path: path\n                }];\n            }\n          });\n        });\n      };\n\n      return runTransaction;\n    };\n\n    return _this;\n  }\n\n  FirebaseDatabaseTransactionWithContext.prototype.shouldComponentUpdate = function (nextProps) {\n    return nextProps.path !== this.props.path || nextProps.firebase !== this.props.firebase;\n  };\n\n  FirebaseDatabaseTransactionWithContext.prototype.render = function () {\n    var children = this.props.children;\n    var runTransaction = this.createTransactionRunner();\n    return renderAndAddProps(children, __assign({\n      runTransaction: runTransaction\n    }, this.props));\n  };\n\n  return FirebaseDatabaseTransactionWithContext;\n}(Component);\n\nvar FirebaseDatabaseTransaction = function (_super) {\n  __extends(FirebaseDatabaseTransaction, _super);\n\n  function FirebaseDatabaseTransaction() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  FirebaseDatabaseTransaction.prototype.render = function () {\n    var _a = this.props,\n        children = _a.children,\n        path = _a.path;\n    var FirebaseDatabaseContextConsumer = getContext().FirebaseDatabaseContextConsumer;\n    return createElement(FirebaseDatabaseContextConsumer, null, function (context) {\n      return createElement(FirebaseDatabaseTransactionWithContext, __assign({\n        path: path\n      }, context, {\n        children: children\n      }));\n    });\n  };\n\n  return FirebaseDatabaseTransaction;\n}(Component);\n\nexport { FirebaseDatabaseNode, FirebaseDatabaseNodes, FirebaseDatabaseProvider, FirebaseDatabaseMutation, FirebaseDatabaseTransaction, getFirebaseQuery, initializeFirebaseApp };","map":{"version":3,"sources":["/Users/tamirhen/Desktop/Irrigation-System-React/irrigation-react/node_modules/@react-firebase/database/dist/index.esm.js"],"names":["createElement","Fragment","Component","PureComponent","createContext","memoize","renderAndAddProps","produce$1","produce","sortBy","keys","set","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__extends","__","constructor","prototype","create","__assign","assign","t","s","i","n","arguments","length","call","apply","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","__generator","body","_","label","sent","trys","ops","f","y","g","verb","Symbol","iterator","v","op","TypeError","pop","push","firebaseDatabaseDefaultContext","firebase","getContext","createContext$$1","defaultContext","_a","FirebaseDatabaseContextProvider","Provider","FirebaseDatabaseContextConsumer","Consumer","initializeFirebaseApp","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","apiKey","appId","measurementId","initializeApp","err","code","FirebaseDatabaseProvider","_super","props","_this","__isMounted","state","render","children","getFirebaseQuery","_b","path","_c","orderByChild","_d","orderByKey","_e","orderByValue","_f","limitToFirst","_g","limitToLast","_h","startAt","_j","endAt","_k","equalTo","Error","database","ref","dataNodeProps","getPropsOrNull","cleanProps","_i","dataNodeProps_1","propName","havePropsChanged","prevProps","dataNodeProps_2","hasStateChanged","prevState","keysICareAbout","keysICareAbout_1","reducers","setIsLoading","isLoading","draft","setValue","setPath","addKeyToList","key","isArray","filter","k","concat","removeKeyFromList","addToList","order","data","orderedList","sort","a","removeFromList","removeFirstFromList","count","arrayLength","slice","removeLastFromList","prependKeyToList","prependToList","FirebaseDatabaseContextConsumerLifeCycle","keysOnly","once","isList","unsub","ss","setState","bind","onValue","val","unsortedKeys","sortedKeys","map","handleOnce","handleOn","on","listenToRef","propsOrNull","query","componentDidMount","componentDidUpdate","componentWillUnmount","shouldComponentUpdate","nextProps","nextState","FirebaseDatabaseNode","context","initialState","addNodeToState","id","updatedState","newState","PureNodeReader","onChange","FirebaseDatabaseNodes","_loop_1","node","this_1","nodes","nodeIDs","_loop_2","nodeID","this_2","nodeIDs_1","FirebaseDatabaseMutationWithContext","createMutationRunner","type","firebaseRef","app","runMutation","update","FirebaseDatabaseMutation","FirebaseDatabaseTransactionWithContext","createTransactionRunner","runTransaction","reducer","transaction","FirebaseDatabaseTransaction"],"mappings":"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","sourcesContent":["import { createElement, Fragment, Component, PureComponent, createContext } from 'react';\nimport memoize from 'lodash/memoize';\nimport { renderAndAddProps } from 'render-and-add-props';\nimport produce$1, { produce } from 'immer';\nimport sortBy from 'lodash/sortBy';\nimport keys from 'lodash/keys';\nimport set from 'lodash/set';\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nfunction __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nvar __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nfunction __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\n\nvar firebaseDatabaseDefaultContext = {\r\n    firebase: {}\r\n};\r\nvar getContext = memoize(function (createContext$$1) {\r\n    if (createContext$$1 === void 0) { createContext$$1 = function (defaultContext) {\r\n        return createContext(defaultContext);\r\n    }; }\r\n    var _a = createContext$$1(firebaseDatabaseDefaultContext), FirebaseDatabaseContextProvider = _a.Provider, FirebaseDatabaseContextConsumer = _a.Consumer;\r\n    return {\r\n        FirebaseDatabaseContextProvider: FirebaseDatabaseContextProvider,\r\n        FirebaseDatabaseContextConsumer: FirebaseDatabaseContextConsumer\r\n    };\r\n}, function () { return 1; });\n\nvar initializeFirebaseApp = function (_a) {\r\n    var firebase = _a.firebase, authDomain = _a.authDomain, databaseURL = _a.databaseURL, projectId = _a.projectId, storageBucket = _a.storageBucket, messagingSenderId = _a.messagingSenderId, apiKey = _a.apiKey, appId = _a.appId, measurementId = _a.measurementId;\r\n    try {\r\n        firebase.initializeApp({\r\n            apiKey: apiKey,\r\n            authDomain: authDomain,\r\n            databaseURL: databaseURL,\r\n            projectId: projectId,\r\n            storageBucket: storageBucket,\r\n            messagingSenderId: messagingSenderId,\r\n            appId: appId,\r\n            measurementId: measurementId\r\n        });\r\n    }\r\n    catch (err) {\r\n        if (err.code !== \"app/duplicate-app\") {\r\n            throw err;\r\n        }\r\n    }\r\n};\n\nvar FirebaseDatabaseProvider = (function (_super) {\r\n    __extends(FirebaseDatabaseProvider, _super);\r\n    function FirebaseDatabaseProvider(props) {\r\n        var _this = _super.call(this, props) || this;\r\n        _this.__isMounted = true;\r\n        _this.state = {\r\n            firebase: props.firebase\r\n        };\r\n        if (_this.props.apiKey) {\r\n            initializeFirebaseApp(_this.props);\r\n        }\r\n        return _this;\r\n    }\r\n    FirebaseDatabaseProvider.prototype.render = function () {\r\n        var _a = this.props, children = _a.children, createContext$$1 = _a.createContext;\r\n        var FirebaseDatabaseContextProvider = getContext(createContext$$1).FirebaseDatabaseContextProvider;\r\n        return (createElement(FirebaseDatabaseContextProvider, { value: this.state }, renderAndAddProps(children, {})));\r\n    };\r\n    return FirebaseDatabaseProvider;\r\n}(Component));\n\nvar getFirebaseQuery = function (_a) {\r\n    var _b = _a.firebase, firebase = _b === void 0 ? null : _b, path = _a.path, _c = _a.orderByChild, orderByChild = _c === void 0 ? null : _c, _d = _a.orderByKey, orderByKey = _d === void 0 ? null : _d, _e = _a.orderByValue, orderByValue = _e === void 0 ? null : _e, _f = _a.limitToFirst, limitToFirst = _f === void 0 ? null : _f, _g = _a.limitToLast, limitToLast = _g === void 0 ? null : _g, _h = _a.startAt, startAt = _h === void 0 ? null : _h, _j = _a.endAt, endAt = _j === void 0 ? null : _j, _k = _a.equalTo, equalTo = _k === void 0 ? null : _k;\r\n    if (firebase === null) {\r\n        throw new Error(\"Need to supply firebase argument to getFirebaseQuery\");\r\n    }\r\n    if (path === null || typeof path === \"undefined\") {\r\n        throw new Error(\"Need to supply path argument to getFirebaseQuery\");\r\n    }\r\n    var result = firebase.database().ref(path);\r\n    if (orderByChild !== null) {\r\n        result = result.orderByChild(orderByChild);\r\n    }\r\n    if (orderByKey !== null) {\r\n        result = result.orderByKey();\r\n    }\r\n    if (orderByValue !== null) {\r\n        result = result.orderByValue();\r\n    }\r\n    if (limitToFirst !== null) {\r\n        result = result.limitToFirst(limitToFirst);\r\n    }\r\n    if (limitToLast !== null) {\r\n        result = result.limitToLast(limitToLast);\r\n    }\r\n    if (startAt !== null) {\r\n        result = result.startAt(startAt);\r\n    }\r\n    if (endAt !== null) {\r\n        result = result.endAt(endAt);\r\n    }\r\n    if (equalTo !== null) {\r\n        result = result.equalTo(equalTo);\r\n    }\r\n    return result;\r\n};\n\nvar dataNodeProps = [\r\n    \"firebase\",\r\n    \"path\",\r\n    \"orderByChild\",\r\n    \"orderByKey\",\r\n    \"orderByValue\",\r\n    \"limitToFirst\",\r\n    \"limitToLast\",\r\n    \"startAt\",\r\n    \"endAt\",\r\n    \"equalTo\",\r\n    \"keysOnly\",\r\n    \"once\",\r\n    \"isList\",\r\n    \"unsub\"\r\n];\r\nvar getPropsOrNull = function (props) {\r\n    var cleanProps = {};\r\n    for (var _i = 0, dataNodeProps_1 = dataNodeProps; _i < dataNodeProps_1.length; _i++) {\r\n        var propName = dataNodeProps_1[_i];\r\n        if (props[propName]) {\r\n            cleanProps[propName] = props[propName];\r\n        }\r\n        else {\r\n            cleanProps[propName] = null;\r\n        }\r\n    }\r\n    return cleanProps;\r\n};\r\nvar havePropsChanged = function (prevProps, props) {\r\n    for (var _i = 0, dataNodeProps_2 = dataNodeProps; _i < dataNodeProps_2.length; _i++) {\r\n        var propName = dataNodeProps_2[_i];\r\n        if (props[propName] !== prevProps[propName]) {\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n};\r\nvar hasStateChanged = function (prevState, state) {\r\n    var keysICareAbout = [\"firebase\", \"value\", \"isLoading\", \"path\"];\r\n    for (var _i = 0, keysICareAbout_1 = keysICareAbout; _i < keysICareAbout_1.length; _i++) {\r\n        var propName = keysICareAbout_1[_i];\r\n        if (state[propName] !== prevState[propName]) {\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n};\r\nvar reducers = {\r\n    setIsLoading: function (isLoading) { return function (state) {\r\n        return produce(state, function (draft) {\r\n            draft.isLoading = isLoading;\r\n        });\r\n    }; },\r\n    setValue: function (value) { return function (state) {\r\n        return produce(state, function (draft) {\r\n            draft.value = value;\r\n        });\r\n    }; },\r\n    setPath: function (path) { return function (state) {\r\n        return produce(state, function (draft) {\r\n            draft.path = path;\r\n        });\r\n    }; },\r\n    addKeyToList: function (key) { return function (state) {\r\n        return produce(state, function (draft) {\r\n            if (!Array.isArray(draft.value)) {\r\n                draft.value = [key];\r\n                return;\r\n            }\r\n            draft.value = draft.value.filter(function (k) { return k !== key; }).concat([key]);\r\n        });\r\n    }; },\r\n    removeKeyFromList: function (key) { return function (state) {\r\n        return produce(state, function (draft) {\r\n            if (!Array.isArray(draft.value)) {\r\n                draft.value = [];\r\n                return;\r\n            }\r\n            draft.value = draft.value.filter(function (k) { return k !== key; });\r\n        });\r\n    }; },\r\n    addToList: function (value, key, order) { return function (state) {\r\n        return produce(state, function (draft) {\r\n            if (!Array.isArray(draft.value)) {\r\n                draft.value = [{ data: value, key: key, order: order }];\r\n                return;\r\n            }\r\n            var orderedList = draft.value.filter(function (v) { return v.key !== key; }).concat([\r\n                { data: value, key: key, order: order }\r\n            ]);\r\n            draft.value = orderedList.sort(function (a, b) { return a.order - b.order; });\r\n        });\r\n    }; },\r\n    removeFromList: function (value, key) { return function (state) {\r\n        return produce(state, function (draft) {\r\n            if (!Array.isArray(draft.value)) {\r\n                draft.value = [];\r\n                return;\r\n            }\r\n            draft.value = draft.value.filter(function (v) { return v.key !== key; });\r\n        });\r\n    }; },\r\n    removeFirstFromList: function (count) { return function (state) {\r\n        return produce(state, function (draft) {\r\n            if (!Array.isArray(draft.value)) {\r\n                draft.value = [];\r\n                return;\r\n            }\r\n            var arrayLength = draft.value.length;\r\n            draft.value = draft.value.slice(arrayLength - count, arrayLength - 1);\r\n        });\r\n    }; },\r\n    removeLastFromList: function (count) { return function (state) {\r\n        return produce(state, function (draft) {\r\n            if (!Array.isArray(draft.value)) {\r\n                draft.value = [];\r\n                return;\r\n            }\r\n            var arrayLength = draft.value.length;\r\n            draft.value = draft.value.slice(0, arrayLength - count);\r\n        });\r\n    }; },\r\n    prependKeyToList: function (key) { return function (state) {\r\n        return produce(state, function (draft) {\r\n            if (!Array.isArray(draft.value)) {\r\n                draft.value = [key];\r\n                return;\r\n            }\r\n            draft.value = [key].concat(draft.value.filter(function (k) { return k !== key; }));\r\n        });\r\n    }; },\r\n    prependToList: function (value, key) { return function (state) {\r\n        return produce(state, function (draft) {\r\n            if (!Array.isArray(draft.value)) {\r\n                draft.value = [{ data: value, key: key }];\r\n                return;\r\n            }\r\n            draft.value = [\r\n                { data: value, key: key }\r\n            ].concat(draft.value.filter(function (v) { return v.key !== key; }));\r\n        });\r\n    }; }\r\n};\n\nvar FirebaseDatabaseContextConsumerLifeCycle = (function (_super) {\r\n    __extends(FirebaseDatabaseContextConsumerLifeCycle, _super);\r\n    function FirebaseDatabaseContextConsumerLifeCycle() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.state = {\r\n            firebase: null,\r\n            path: null,\r\n            orderByChild: null,\r\n            orderByKey: null,\r\n            orderByValue: null,\r\n            limitToFirst: null,\r\n            limitToLast: null,\r\n            startAt: null,\r\n            endAt: null,\r\n            equalTo: null,\r\n            keysOnly: null,\r\n            once: null,\r\n            isList: null,\r\n            unsub: null,\r\n            value: null,\r\n            isLoading: null\r\n        };\r\n        _this.__isMounted = false;\r\n        _this.ss = function () {\r\n            if (_this.__isMounted === false) {\r\n                return (function () { });\r\n            }\r\n            return _this.setState.bind(_this);\r\n        };\r\n        _this.onValue = function (props, v) {\r\n            if (!v)\r\n                return;\r\n            if (v.val() === null)\r\n                return;\r\n            var value = v.val();\r\n            var keysOnly = props.keysOnly, isList = props.isList, orderByChild = props.orderByChild, orderByKey = props.orderByKey, orderByValue = props.orderByValue;\r\n            if (!keysOnly && !isList) {\r\n                _this.ss()(reducers.setValue(value));\r\n                return;\r\n            }\r\n            var unsortedKeys = keys(value);\r\n            var sortedKeys = orderByChild\r\n                ? sortBy(unsortedKeys, function (key) { return value[key][orderByChild]; })\r\n                : orderByKey\r\n                    ? sortBy(unsortedKeys, function (key) { return key; })\r\n                    : orderByValue\r\n                        ? sortBy(unsortedKeys, function (key) { return value[key]; })\r\n                        : unsortedKeys;\r\n            if (keysOnly) {\r\n                _this.ss()(reducers.setValue(sortedKeys));\r\n                return;\r\n            }\r\n            if (isList) {\r\n                var val = sortedKeys.map(function (key) { return ({ key: key, data: value[key] }); });\r\n                _this.ss()(reducers.setValue(val));\r\n                return;\r\n            }\r\n            else {\r\n                _this.ss()(reducers.setValue(value));\r\n                return;\r\n            }\r\n        };\r\n        _this.handleOnce = function (props, ref) {\r\n            _this.ss()(reducers.setIsLoading(true));\r\n            ref.once(\"value\", function (v) {\r\n                _this.ss()(reducers.setIsLoading(false));\r\n                _this.onValue(props, v);\r\n            });\r\n        };\r\n        _this.handleOn = function (props, ref) {\r\n            _this.unsub && _this.unsub();\r\n            _this.ss()(reducers.setIsLoading(true));\r\n            _this.unsub = ref.on(\"value\", function (v) {\r\n                _this.ss()(reducers.setIsLoading(false));\r\n                _this.onValue(props, v);\r\n            });\r\n        };\r\n        _this.listenToRef = function (props) {\r\n            var propsOrNull = getPropsOrNull(_this.props);\r\n            var firebase = propsOrNull.firebase, path = propsOrNull.path;\r\n            if (firebase === null) {\r\n                return;\r\n            }\r\n            if (path === null) {\r\n                return;\r\n            }\r\n            _this.ss()(reducers.setPath(path));\r\n            _this.ss()(reducers.setIsLoading(true));\r\n            var query = getFirebaseQuery(propsOrNull);\r\n            if (propsOrNull.once) {\r\n                _this.handleOnce(props, query);\r\n            }\r\n            else {\r\n                _this.handleOn(props, query);\r\n            }\r\n        };\r\n        return _this;\r\n    }\r\n    FirebaseDatabaseContextConsumerLifeCycle.prototype.componentDidMount = function () {\r\n        this.__isMounted = true;\r\n        this.listenToRef(getPropsOrNull(this.props));\r\n    };\r\n    FirebaseDatabaseContextConsumerLifeCycle.prototype.componentDidUpdate = function (prevProps) {\r\n        if (havePropsChanged(this.props, prevProps)) {\r\n            this.listenToRef(getPropsOrNull(this.props));\r\n        }\r\n    };\r\n    FirebaseDatabaseContextConsumerLifeCycle.prototype.componentWillUnmount = function () {\r\n        this.__isMounted = false;\r\n        this.unsub && this.unsub();\r\n    };\r\n    FirebaseDatabaseContextConsumerLifeCycle.prototype.shouldComponentUpdate = function (nextProps, nextState) {\r\n        return (havePropsChanged(this.props, nextProps) ||\r\n            hasStateChanged(this.state, nextState));\r\n    };\r\n    FirebaseDatabaseContextConsumerLifeCycle.prototype.render = function () {\r\n        var _a = this.state, path = _a.path, value = _a.value, isLoading = _a.isLoading;\r\n        return renderAndAddProps(this.props.children, { path: path, value: value, isLoading: isLoading });\r\n    };\r\n    return FirebaseDatabaseContextConsumerLifeCycle;\r\n}(Component));\n\nvar FirebaseDatabaseNode = (function (_super) {\r\n    __extends(FirebaseDatabaseNode, _super);\r\n    function FirebaseDatabaseNode() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    FirebaseDatabaseNode.prototype.render = function () {\r\n        var _this = this;\r\n        var FirebaseDatabaseContextConsumer = getContext().FirebaseDatabaseContextConsumer;\r\n        return (createElement(FirebaseDatabaseContextConsumer, null, function (context) {\r\n            return (createElement(Fragment, null,\r\n                createElement(FirebaseDatabaseContextConsumerLifeCycle, __assign({ firebase: context.firebase }, _this.props))));\r\n        }));\r\n    };\r\n    return FirebaseDatabaseNode;\r\n}(Component));\n\nvar initialState = {\r\n    isLoading: true,\r\n    value: {}\r\n};\r\nvar addNodeToState = function (state, _a) {\r\n    var id = _a.id, value = _a.value, isLoading = _a.isLoading;\r\n    var updatedState = produce$1(state, function (newState) {\r\n        set(newState, \"value.\" + id + \".value\", value);\r\n        set(newState, \"value.\" + id + \".isLoading\", isLoading);\r\n        return newState;\r\n    });\r\n    return updatedState;\r\n};\r\nvar PureNodeReader = (function (_super) {\r\n    __extends(PureNodeReader, _super);\r\n    function PureNodeReader() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    PureNodeReader.prototype.componentDidMount = function () {\r\n        var _a = this.props, id = _a.id, value = _a.value, isLoading = _a.isLoading, onChange = _a.onChange;\r\n        onChange({ id: id, value: value, isLoading: isLoading, onChange: onChange });\r\n    };\r\n    PureNodeReader.prototype.componentDidUpdate = function () {\r\n        var _a = this.props, id = _a.id, value = _a.value, isLoading = _a.isLoading, onChange = _a.onChange;\r\n        onChange({ id: id, value: value, isLoading: isLoading, onChange: onChange });\r\n    };\r\n    PureNodeReader.prototype.shouldComponentUpdate = function (prevProps) {\r\n        var _a = this.props, id = _a.id, value = _a.value, isLoading = _a.isLoading, onChange = _a.onChange;\r\n        return (prevProps.id !== id ||\r\n            prevProps.value !== value ||\r\n            prevProps.isLoading !== isLoading);\r\n    };\r\n    PureNodeReader.prototype.render = function () {\r\n        return null;\r\n    };\r\n    return PureNodeReader;\r\n}(Component));\r\nvar FirebaseDatabaseNodes = (function (_super) {\r\n    __extends(FirebaseDatabaseNodes, _super);\r\n    function FirebaseDatabaseNodes() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.state = initialState;\r\n        return _this;\r\n    }\r\n    FirebaseDatabaseNodes.prototype.componentDidMount = function () {\r\n        var _loop_1 = function (node) {\r\n            var id = node.id;\r\n            this_1.setState(function (state) {\r\n                return addNodeToState(state, { id: id, value: null, isLoading: true });\r\n            });\r\n        };\r\n        var this_1 = this;\r\n        for (var _i = 0, _a = this.props.nodes; _i < _a.length; _i++) {\r\n            var node = _a[_i];\r\n            _loop_1(node);\r\n        }\r\n    };\r\n    FirebaseDatabaseNodes.prototype.componentDidUpdate = function () {\r\n        var nodeIDs = this.props.nodes.map(function (n) { return n.id; });\r\n        var _loop_2 = function (nodeID) {\r\n            if (!(nodeID in this_2.state.value)) {\r\n                this_2.setState(function (state) {\r\n                    return addNodeToState(state, { id: nodeID, value: null, isLoading: true });\r\n                });\r\n            }\r\n        };\r\n        var this_2 = this;\r\n        for (var _i = 0, nodeIDs_1 = nodeIDs; _i < nodeIDs_1.length; _i++) {\r\n            var nodeID = nodeIDs_1[_i];\r\n            _loop_2(nodeID);\r\n        }\r\n    };\r\n    FirebaseDatabaseNodes.prototype.render = function () {\r\n        var _this = this;\r\n        return (createElement(Fragment, null,\r\n            this.props.nodes.map(function (node) { return (createElement(FirebaseDatabaseNode, __assign({ path: node.path, key: node.id }, node.query), function (_a) {\r\n                var value = _a.value, isLoading = _a.isLoading;\r\n                return (createElement(PureNodeReader, { value: value, isLoading: isLoading, id: node.id, onChange: function (_a) {\r\n                        var id = _a.id, value = _a.value, isLoading = _a.isLoading;\r\n                        _this.setState(function (state) {\r\n                            return addNodeToState(state, { id: id, value: value, isLoading: isLoading });\r\n                        });\r\n                    } }));\r\n            })); }),\r\n            renderAndAddProps(this.props.children, this.state)));\r\n    };\r\n    return FirebaseDatabaseNodes;\r\n}(PureComponent));\n\nvar FirebaseDatabaseMutationWithContext = (function (_super) {\r\n    __extends(FirebaseDatabaseMutationWithContext, _super);\r\n    function FirebaseDatabaseMutationWithContext() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.createMutationRunner = function () {\r\n            var _a = _this.props, firebase = _a.firebase, path = _a.path, type = _a.type;\r\n            var firebaseRef = firebase\r\n                .app()\r\n                .database()\r\n                .ref(path);\r\n            var runMutation;\r\n            switch (type) {\r\n                case \"push\": {\r\n                    runMutation = function (value) { return __awaiter(_this, void 0, void 0, function () {\r\n                        var key;\r\n                        return __generator(this, function (_a) {\r\n                            switch (_a.label) {\r\n                                case 0: return [4, firebaseRef.push(value).key];\r\n                                case 1:\r\n                                    key = _a.sent();\r\n                                    return [2, {\r\n                                            path: path,\r\n                                            value: value,\r\n                                            type: type,\r\n                                            key: key\r\n                                        }];\r\n                            }\r\n                        });\r\n                    }); };\r\n                    break;\r\n                }\r\n                case \"update\": {\r\n                    runMutation = function (value) { return __awaiter(_this, void 0, void 0, function () {\r\n                        return __generator(this, function (_a) {\r\n                            switch (_a.label) {\r\n                                case 0: return [4, firebaseRef.update(value)];\r\n                                case 1:\r\n                                    _a.sent();\r\n                                    return [2, {\r\n                                            path: path,\r\n                                            value: value,\r\n                                            type: type,\r\n                                            key: null\r\n                                        }];\r\n                            }\r\n                        });\r\n                    }); };\r\n                    break;\r\n                }\r\n                case \"set\": {\r\n                    runMutation = function (value) { return __awaiter(_this, void 0, void 0, function () {\r\n                        return __generator(this, function (_a) {\r\n                            switch (_a.label) {\r\n                                case 0: return [4, firebaseRef.set(value)];\r\n                                case 1:\r\n                                    _a.sent();\r\n                                    return [2, {\r\n                                            path: path,\r\n                                            value: value,\r\n                                            type: type,\r\n                                            key: null\r\n                                        }];\r\n                            }\r\n                        });\r\n                    }); };\r\n                    break;\r\n                }\r\n                default: {\r\n                    throw new Error(\"Unsupported mutation type \" + type + \". \\nPlease file an issue if you'd like to see us support it !\");\r\n                }\r\n            }\r\n            return runMutation;\r\n        };\r\n        return _this;\r\n    }\r\n    FirebaseDatabaseMutationWithContext.prototype.shouldComponentUpdate = function (nextProps) {\r\n        return (nextProps.path !== this.props.path ||\r\n            nextProps.firebase !== this.props.firebase);\r\n    };\r\n    FirebaseDatabaseMutationWithContext.prototype.render = function () {\r\n        var children = this.props.children;\r\n        var runMutation = this.createMutationRunner();\r\n        return renderAndAddProps(children, __assign({ runMutation: runMutation }, this.props));\r\n    };\r\n    return FirebaseDatabaseMutationWithContext;\r\n}(Component));\r\nvar FirebaseDatabaseMutation = (function (_super) {\r\n    __extends(FirebaseDatabaseMutation, _super);\r\n    function FirebaseDatabaseMutation() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    FirebaseDatabaseMutation.prototype.render = function () {\r\n        var _a = this.props, children = _a.children, type = _a.type, path = _a.path;\r\n        var FirebaseDatabaseContextConsumer = getContext().FirebaseDatabaseContextConsumer;\r\n        return (createElement(FirebaseDatabaseContextConsumer, null, function (context) { return (createElement(FirebaseDatabaseMutationWithContext, __assign({ type: type, path: path }, context, { children: children }))); }));\r\n    };\r\n    return FirebaseDatabaseMutation;\r\n}(Component));\n\nvar FirebaseDatabaseTransactionWithContext = (function (_super) {\r\n    __extends(FirebaseDatabaseTransactionWithContext, _super);\r\n    function FirebaseDatabaseTransactionWithContext() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.createTransactionRunner = function () {\r\n            var _a = _this.props, firebase = _a.firebase, path = _a.path;\r\n            var firebaseRef = firebase\r\n                .app()\r\n                .database()\r\n                .ref(path);\r\n            var runTransaction = function (_a) {\r\n                var reducer = _a.reducer;\r\n                return __awaiter(_this, void 0, void 0, function () {\r\n                    return __generator(this, function (_b) {\r\n                        switch (_b.label) {\r\n                            case 0: return [4, firebaseRef.transaction(reducer)];\r\n                            case 1:\r\n                                _b.sent();\r\n                                return [2, { path: path }];\r\n                        }\r\n                    });\r\n                });\r\n            };\r\n            return runTransaction;\r\n        };\r\n        return _this;\r\n    }\r\n    FirebaseDatabaseTransactionWithContext.prototype.shouldComponentUpdate = function (nextProps) {\r\n        return (nextProps.path !== this.props.path ||\r\n            nextProps.firebase !== this.props.firebase);\r\n    };\r\n    FirebaseDatabaseTransactionWithContext.prototype.render = function () {\r\n        var children = this.props.children;\r\n        var runTransaction = this.createTransactionRunner();\r\n        return renderAndAddProps(children, __assign({ runTransaction: runTransaction }, this.props));\r\n    };\r\n    return FirebaseDatabaseTransactionWithContext;\r\n}(Component));\r\nvar FirebaseDatabaseTransaction = (function (_super) {\r\n    __extends(FirebaseDatabaseTransaction, _super);\r\n    function FirebaseDatabaseTransaction() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    FirebaseDatabaseTransaction.prototype.render = function () {\r\n        var _a = this.props, children = _a.children, path = _a.path;\r\n        var FirebaseDatabaseContextConsumer = getContext().FirebaseDatabaseContextConsumer;\r\n        return (createElement(FirebaseDatabaseContextConsumer, null, function (context) { return (createElement(FirebaseDatabaseTransactionWithContext, __assign({ path: path }, context, { children: children }))); }));\r\n    };\r\n    return FirebaseDatabaseTransaction;\r\n}(Component));\n\nexport { FirebaseDatabaseNode, FirebaseDatabaseNodes, FirebaseDatabaseProvider, FirebaseDatabaseMutation, FirebaseDatabaseTransaction, getFirebaseQuery, initializeFirebaseApp };\n"]},"metadata":{},"sourceType":"module"}